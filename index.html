<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Incremental Multiplied</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
  <script src="./ExpantaNum.js"></script>
  <style>
    body {
      font-family: 'Roboto Mono', monospace;
      background-color: #272727;
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    h1 {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 40px;
    }

    .container {
      background-color: #181818;
      border: 1px solid #000000;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(255, 255, 255, 0.1);
      width: 85%;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      align-items: middle;
      text-align: center;
    }

    .value-label {
      font-size: 100%;
      margin-bottom: 20px;
      color: #ffffff;
    }
    .title-label {
      font-size: 100%;
      margin-bottom: 20px;
      color: #ffffff;
    }

    .value-display {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #ffffff;
    }

    .action-button {
      font-size: 14px;
      padding: 10px 15px;
      border: none;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      border-radius: 6px;
      writing-mode: horizontal-tb;
    }

    .action-button:hover {
      background-color: #388e3c;
    }
  </style>
</head>
<body>
  <div class="title-label"><h1>Incremental Multiplied</h1></div>

  <div class="container">
    <div class="value-label">Cash</div>
    <div class="value-display" id="cashValue">読み込み中...</div>
    <button class="action-button" id="addCashBtn">buy</button>
  </div>

  <div class="container">
    <div class="value-label">Rebirth</div>
    <div class="value-display" id="rebirthValue">読み込み中...</div>
    <button class="action-button" id="addRebirthBtn">+1</button>
  </div>

  <script>
    let cash = new ExpantaNum(0);
    let rebirth = new ExpantaNum(0);
  
    // 保存されているデータの読み込み
    function loadFromLocalStorage() {
      const saved = localStorage.getItem('gameSave');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          cash = new ExpantaNum(data.Cash || 0);
          rebirth = new ExpantaNum(data.Rebirth || 0);
        } catch (e) {
          console.error('保存データの読み込みエラー:', e);
        }
      }
    }
  
    // データ保存
    function saveToLocalStorage() {
      const data = {
        Cash: cash.toString(),
        Rebirth: rebirth.toString()
      };
      localStorage.setItem('gameSave', JSON.stringify(data));
    }
  
    // JSONファイルがあれば読み込み → なければ保存済みの値
    fetch('data.json')
      .then(response => response.json())
      .then(data => {
        if (!localStorage.getItem('gameSave')) {
          cash = new ExpantaNum(data.Cash || 0);
          rebirth = new ExpantaNum(data.Rebirth || 0);
        } else {
          loadFromLocalStorage();
        }
        updateDisplays();
      })
      .catch(error => {
        console.warn('data.jsonの読み込み失敗。保存データを使用します。');
        loadFromLocalStorage();
        updateDisplays();
      });
  
    function updateDisplays() {  
      document.getElementById('cashValue').textContent = '$' + cash.toHyperE();
      document.getElementById('rebirthValue').textContent = rebirth.toHyperE();

      if (cash.gte(new ExpantaNum([303,1]))) {
        document.getElementById('addRebirthBtn').textContent = '+1';
      } else {
        document.getElementById('addRebirthBtn').textContent = 'Reach 1e+303 Cash';
      }

    }
  
    function bounceButton(button) {
      button.classList.remove('bouncing');
      void button.offsetWidth;
      button.classList.add('bouncing');
    }
  
    document.getElementById('addCashBtn').addEventListener('click', function () {
      let val = cash.mul(new ExpantaNum(2)).add(rebirth)
      cash = cash.add(val);
      updateDisplays();
      bounceButton(this);
      saveToLocalStorage();
    });
  
    document.getElementById('addRebirthBtn').addEventListener('click', function () {
      if (cash.gte(new ExpantaNum([303,1]))) {
        rebirth = rebirth.add(new ExpantaNum(1));
        cash = new ExpantaNum(0)
      }
      updateDisplays();
      bounceButton(this);
      saveToLocalStorage();
    });
  </script>
  
</body>
</html>
